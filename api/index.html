<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="List of ABI Implementations" href="../abi/index.html" /><link rel="prev" title="Installation" href="../installation.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>API Concepts &amp; Reference - Umbrella 0.0.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css?v=4c969af8" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Umbrella 0.0.4 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Umbrella 0.0.4 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Using this Library</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">API Concepts &amp; Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../abi/index.html">List of ABI Implementations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="runtime.html">Static Runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="iterator.html">Iterators</a></li>
<li class="toctree-l1"><a class="reference internal" href="flags.html">Flags and FlagSet</a></li>
<li class="toctree-l1"><a class="reference internal" href="dump.html">Class-Dump</a></li>
<li class="toctree-l1"><a class="reference internal" href="trailing_objects.html">Trailing Objects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ABI Implementations</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../abi/swift/index.html">1. Swift ABI</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 1. Swift ABI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../abi/swift/metadata_values.html">1.1. Metadata Values (Enums)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/swift/reconstruction.html">1.2. Reconstruction of Swift Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/swift/reconstruction.html#protocols">1.3. Protocols</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../abi/objc/index.html">2. Objective-C ABI</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../abi/java/index.html">3. Java Class Files</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 3. Java Class Files</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../abi/java/access_flags.html">3.1.1. Access Flags (Enums)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/java/constant_pool.html">3.1.2. Constant Pool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../abi/java/attribute.html">3.1.3. Attribute Types</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="api-concepts-reference">
<span id="api-index"></span><h1>API Concepts &amp; Reference<a class="headerlink" href="#api-concepts-reference" title="Link to this heading">#</a></h1>
<p>In the following chapters you will learn about the basement of this library. Each section
describes another feature that can be used to built new ABI implementations for other
languages. Each sub-page contains details on how to use classes mentioned in the next
sections (make sure to take a closer look if you want to implement a new metadata reader).</p>
<p>The basic workflow of each implementation can be visualized as follows:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Metadata Reader Workflow</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                         ┌───────────────────────────────┐
 ┌──────────┐            │                               │
 │          │   Input    │   Custom ABI Implementation   │
 │  Binary  ├───────────►│          &lt;extends&gt;            │
 │          │ using lief │           Runtime             │
 └──────────┘            │                               │
                         └──────────────┬────────────────┘
                                        │ using construct
                                        │ using construct-dataclasses
                                        │
                                        ▼
                            ┌──────────────────────────┐
                            │                          │
                            │   Metadata Information   │
                            │                          │
                            └──────────────────────────┘
</pre></div>
</div>
</div>
<p>The produced metadata information may store all parsed data directly, or it uses umbrella’s
API components to parse the information only if requested. Each ABI implementation must
extend the <code class="xref py py-class docutils literal notranslate"><span class="pre">DataStream</span></code> class to support basic parsing operations. The abstract
<code class="xref py py-class docutils literal notranslate"><span class="pre">Runtime</span></code> class provides default methods on parsing structs, dataclass structs,
strings and pointer sections. In addition, the <code class="xref py py-class docutils literal notranslate"><span class="pre">Runtime</span></code> class supports different
binary formats and adapts parsing based on the used binary.</p>
<p>The user should retrieve all metadata information by providing the parsed binary. The
following example illustrates the process on a Swift binary:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Basic process of parsing a binary storing Swift metadata information</span><a class="headerlink" href="#id2" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">lief.MachO</span> <span class="kn">import</span> <span class="n">parse</span><span class="p">,</span> <span class="n">CPU_TYPES</span>
<span class="linenos">2</span><span class="kn">from</span> <span class="nn">umbrella.swift</span> <span class="kn">import</span> <span class="n">ReflectionContext</span>
<span class="linenos">3</span>
<span class="linenos">4</span><span class="n">binary</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;/path/to/binary&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">CPU_TYPE</span><span class="o">.</span><span class="n">ARM64</span><span class="p">)</span>
<span class="linenos">5</span><span class="n">context</span> <span class="o">=</span> <span class="n">ReflectionContext</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>
<span class="linenos">6</span><span class="c1"># further processing ...</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each class derived from <code class="xref py py-class docutils literal notranslate"><span class="pre">Runtime</span></code> must be initialized with the parsed binary
instance. That enables us more flexibility of operations on the target binary.
Furthermore, we enable multiple ABI implementations to work on the same binary instance
to reduce redundant parsing.</p>
</div>
<section id="virtual-memory-objects">
<h2>Virtual Memory Objects<a class="headerlink" href="#virtual-memory-objects" title="Link to this heading">#</a></h2>
<p>All parsed structures <em>should</em> inherit the <code class="xref py py-class docutils literal notranslate"><span class="pre">Virtual</span></code> class to get identified as virtual
memory objects. They are special as they store the object’s virtual memory address after parsing
has completed. In addition, in order to enable further processing, the parser instance is saved
as well. Using a runtime object, one can simply get the binary content of an object marked as
virtual:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">umbrella.runtime</span> <span class="kn">import</span> <span class="n">sizeof</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="c1"># assume we use the parsed object here</span>
<span class="linenos">4</span><span class="n">obj</span> <span class="o">=</span> <span class="o">...</span>
<span class="linenos">5</span><span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">read_raw</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_address</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
</pre></div>
</div>
<p>These fields will be more relevant later on when inspecting Swift type metadata. For now, it’s
enough to know that we organize all structs as objects of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Virtual</span></code> class. In
addition, there is a <code class="xref py py-class docutils literal notranslate"><span class="pre">VirtualMemoryBlock</span></code> that supports parsing structs or construct
objects within the <em>“virtual”</em> memory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span> <span class="nn">umbrella.runtime</span> <span class="kn">import</span> <span class="n">Runtime</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="n">runtime</span> <span class="o">=</span> <span class="n">Runtime</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="linenos">4</span><span class="c1"># virtual memory block object will be created automatically</span>
<span class="linenos">5</span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">runtime</span><span class="o">+</span><span class="n">FooStructClass</span><span class="p">)</span> <span class="o">@</span> <span class="mh">0xdeadbeef</span>
</pre></div>
</div>
</section>
<section id="caching-iterators">
<h2>Caching Iterators<a class="headerlink" href="#caching-iterators" title="Link to this heading">#</a></h2>
<p>The (as for now) two ABI implementations of Objective-C and Swift use lazy parsing of their
structs to reduce the overall parsing time. They are using a <code class="xref py py-class docutils literal notranslate"><span class="pre">CachingIterator</span></code> to
automatically cache their parsed objects.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is recommended to use these types of iterators instead of plain lists in order to save
time when you want to access specific components. Anyways, you can just use <code class="docutils literal notranslate"><span class="pre">all()</span></code> to
retrieve a list of all parsed structs.</p>
</div>
</section>
<section id="dumper">
<h2>Dumper<a class="headerlink" href="#dumper" title="Link to this heading">#</a></h2>
<p>Finally, there is an abstract dumper template that can be used to implement a “class-dump” like
class. It is intended to simplify the process of generating and writing output to an <code class="docutils literal notranslate"><span class="pre">IOBase</span></code> object. In
addition, it integrates <code class="docutils literal notranslate"><span class="pre">pygments</span></code> to colorize the created text. For specific notes and
information about the <code class="xref py py-class docutils literal notranslate"><span class="pre">IDumper</span></code> class, please refer to its section.</p>
</section>
<section id="api-components">
<h2>API Components<a class="headerlink" href="#api-components" title="Link to this heading">#</a></h2>
<dl class="simple">
<dt><a class="reference internal" href="runtime.html"><span class="doc">Basic Runtime API</span></a></dt><dd><p>Standard API classes that form the basement of this library</p>
</dd>
<dt><a class="reference internal" href="iterator.html"><span class="doc">Iterator Types</span></a></dt><dd><p>A small collection of iterator types that enable caching and lazy parsing.</p>
</dd>
<dt><a class="reference internal" href="flags.html"><span class="doc">Flags</span></a></dt><dd><p>In introduction on how flags can be handled and integrated with a custom class.</p>
</dd>
<dt><a class="reference internal" href="dump.html"><span class="doc">Dump</span></a></dt><dd><p>The dumper architecture for this library.</p>
</dd>
<dt><a class="reference internal" href="trailing_objects.html"><span class="doc">Trailing Objects</span></a></dt><dd><p>A review of how we implemented <code class="docutils literal notranslate"><span class="pre">TrailingObjects</span></code> in pure Python.</p>
</dd>
</dl>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../abi/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">List of ABI Implementations</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../installation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, MatrixEditor
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">API Concepts &amp; Reference</a><ul>
<li><a class="reference internal" href="#virtual-memory-objects">Virtual Memory Objects</a></li>
<li><a class="reference internal" href="#caching-iterators">Caching Iterators</a></li>
<li><a class="reference internal" href="#dumper">Dumper</a></li>
<li><a class="reference internal" href="#api-components">API Components</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=8c5712d9"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../_static/tabs.js?v=3ee01567"></script>
    </body>
</html>